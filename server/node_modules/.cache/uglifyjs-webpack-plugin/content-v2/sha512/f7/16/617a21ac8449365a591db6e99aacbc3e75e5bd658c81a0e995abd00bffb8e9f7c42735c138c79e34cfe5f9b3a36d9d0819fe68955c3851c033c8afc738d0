{"code":"module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=\"\",t(t.s=7)}([function(e,r){e.exports=require(\"express\")},function(e,r){e.exports=require(\"passport\")},function(e,r){e.exports=require(\"passport-local\")},function(e,r){e.exports=require(\"bcrypt-nodejs\")},function(e,r){e.exports=require(\"mongoose\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.registerUser=async function(e,r){try{const t=await n.create(e.body);return console.log(t),r.status(201).json(t)}catch(e){return r.status(500).json(e)}},r.loginUser=function(e,r,t){return console.log(e.user),r.status(200).json(e.user),t()};const n=t(6);t(0);r.getUser=function(e,r){console.log(\"indexing users\");let t=\"\";n.find({name:\"Jimmy Testing\"},function(e,n){if(0!=n.length){for(let e=0;e<n.length;e++)t+=n[e].name;r.send(t)}else r.send(\"Sorry no user\")})},r.createUser=function(e,r){new n({name:e.body.name}).save(function(t){if(t)return console.log(t),next(t);r.send(\"Created user, \"+e.body.name)})},r.newUser=function(e,r){r.render(\"newUser\",{})},r.newRegisterUser=function(e,r){r.render(\"register\",{})},r.newLoginUser=function(e,r){r.render(\"register\",{})}},function(e,r,t){\"use strict\";var n=u(t(4)),o=u(t(17)),i=u(t(18)),a=t(3);function u(e){return e&&e.__esModule?e:{default:e}}let s=new n.default.Schema({email:{type:String,unique:!0,required:[!0,\"Email address required!\"],validate:{validator:e=>o.default.isEmail(e)},message:\"{VALUE} is not a valid email.\"},name:{type:String,required:!0,max:100},password:{type:String}});s.plugin(i.default,{message:\"{VALUE} already taken!\"}),s.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),s.methods={_hashPassword:e=>(0,a.hashSync)(e),authenticateUser(e){return(0,a.compareSync)(e,this.password)}},e.exports=n.default.model(\"User\",s)},function(e,r,t){\"use strict\";t(!function(){var e=new Error(\"Cannot find module '../services/auth.services'\");throw e.code=\"MODULE_NOT_FOUND\",e}());const n=t(0),o=(t(8),t(9)),i=(t(10)(o),t(11)),a=t(1),u=(t(2).Strategy,t(12),t(3),t(4)),s=t(13);u.connect(\"mongodb://localhost/ChatAppDB\");const f=n();f.use(i.urlencoded({extended:!0})),f.use(i.json()),f.use(a.initialize()),f.set(\"view engine\",\"ejs\"),f.use(\"/user\",s),f.get(\"/\",(e,r)=>{r.send(\"You got home page!\\n\")}),f.get(\"/login\",(e,r)=>{r.render(\"login\",{})}),f.post(\"/login\",(e,r,t)=>{console.log(\"app.post('/login')\"),a.authenticate(\"local\",(n,o,i)=>i?r.send(i.message):n?t(n):o?void e.login(o,e=>e?t(e):r.redirect(\"/authrequired\")):r.redirect(\"/login\"))(e,r,t)}),f.get(\"/authrequired\",(e,r)=>{e.isAuthenticated()?r.send(\"you hit the authentication endpoint\\n\"):r.redirect(\"/\")}),f.listen(3e3,()=>{console.log(\"Listening on localhost:3000\")}),e.exports=f},function(e,r){e.exports=require(\"uuid/v4\")},function(e,r){e.exports=require(\"express-session\")},function(e,r){e.exports=require(\"session-file-store\")},function(e,r){e.exports=require(\"body-parser\")},function(e,r){e.exports=require(\"axios\")},function(e,r,t){\"use strict\";var n=u(t(14)),o=u(t(15)),i=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,t):{};n.get||n.set?Object.defineProperty(r,t,n):r[t]=e[t]}return r.default=e,r}(t(5)),a=t(19);function u(e){return e&&e.__esModule?e:{default:e}}const s=t(0).Router(),f=t(5);s.get(\"/show\",f.getUser),s.post(\"/new\",f.createUser),s.get(\"/new\",f.newUser),s.post(\"/register\",(0,n.default)(o.default.loginUser),i.registerUser),s.get(\"/register\",f.newRegisterUser),s.post(\"/login\",a.authLocal,i.loginUser),e.exports=s},function(e,r){e.exports=require(\"express-validation\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(t(16));r.default={loginUser:{body:{email:n.default.string().email().required(),password:n.default.string().required(),name:n.default.string().required()}}}},function(e,r){e.exports=require(\"joi\")},function(e,r){e.exports=require(\"validator\")},function(e,r){e.exports=require(\"mongoose-unique-validator\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.authJwt=r.authLocal=void 0;var n=u(t(1)),o=u(t(2)),i=t(35),a=u(t(6));function u(e){return e&&e.__esModule?e:{default:e}}const s=new o.default({usernameField:\"email\"},async(e,r,t)=>{try{const n=await a.default.findOne({email:e});return console.log(n),n&&n.authenticateUser(r)?t(null,n):t(null,!1)}catch(e){return t(e,!1)}}),f={jwtFromRequest:i.ExtractJwt.fromAuthHeader(\"authorization\"),secretOrKey:constants.JWT_SECRET},c=new i.Strategy(f,async(e,r)=>{try{const t=await a.default.findById(e._id);return r(null,t?t:!1)}catch(e){return r(e,!1)}});n.default.use(s),n.default.use(c);r.authLocal=n.default.authenticate(\"local\",{session:!1}),r.authJwt=n.default.authenticate(\"jwt\",{session:!1})},function(e,r){e.exports=require(\"util\")},function(e,r){e.exports=require(\"safe-buffer\")},function(e,r){var t=function(e,r){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=\"JsonWebTokenError\",this.message=e,r&&(this.inner=r)};(t.prototype=Object.create(Error.prototype)).constructor=t,e.exports=t},function(e,r,t){var n=t(41),o=t(46);r.ALGORITHMS=[\"HS256\",\"HS384\",\"HS512\",\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"],r.sign=n.sign,r.verify=o.verify,r.decode=o.decode,r.isValid=o.isValid,r.createSign=function(e){return new n(e)},r.createVerify=function(e){return new o(e)}},function(e,r){e.exports=require(\"stream\")},function(e,r){e.exports=require(\"buffer\")},function(e,r,t){\"use strict\";var n=/(\\S+)\\s+(\\S+)/;e.exports={parse:function(e){if(\"string\"!=typeof e)return null;var r=e.match(n);return r&&{scheme:r[1],value:r[2]}}}},function(e,r){e.exports=require(\"url\")},function(e,r,t){var n=t(23);e.exports=function(e,r){r=r||{};var t=n.decode(e,r);if(!t)return null;var o=t.payload;if(\"string\"==typeof o)try{var i=JSON.parse(o);null!==i&&\"object\"==typeof i&&(o=i)}catch(e){}return!0===r.complete?{header:t.header,payload:o,signature:t.signature}:o}},function(e,r,t){var n=t(21).Buffer,o=t(24);function i(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if(\"function\"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||\"object\"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit(\"end\",e),this.readable=!1,this.emit(\"close\")}.bind(this)),this;throw new TypeError(\"Unexpected data type (\"+typeof e+\")\")}t(20).inherits(i,o),i.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit(\"data\",e)},i.prototype.end=function(e){e&&this.write(e),this.emit(\"end\",e),this.emit(\"close\"),this.writable=!1,this.readable=!1},e.exports=i},function(e,r,t){var n=t(42),o=t(21).Buffer,i=t(43),a=t(44),u=t(20),s=\"secret must be a string or buffer\",f=\"key must be a string or a buffer\",c=\"key must be a string, a buffer or an object\";function l(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function p(e){var r=[].slice.call(arguments,1),t=u.format.bind(u,e).apply(null,r);return new TypeError(t)}function d(e){return o.isBuffer(e)||\"string\"==typeof e}function h(e){return d(e)||(e=JSON.stringify(e)),e}function y(e){return function(r,t){if(!d(t))throw p(s);r=h(r);var n=i.createHmac(\"sha\"+e,t);return l((n.update(r),n.digest(\"base64\")))}}function g(e){return function(r,t,i){var a=y(e)(r,i);return n(o.from(t),o.from(a))}}function b(e){return function(r,t){if(!d(t)&&\"object\"!=typeof t)throw p(c);r=h(r);var n=i.createSign(\"RSA-SHA\"+e);return l((n.update(r),n.sign(t,\"base64\")))}}function v(e){return function(r,t,n){if(!d(n))throw p(f);r=h(r),t=function(e){var r=4-(e=e.toString()).length%4;if(4!==r)for(var t=0;t<r;++t)e+=\"=\";return e.replace(/\\-/g,\"+\").replace(/_/g,\"/\")}(t);var o=i.createVerify(\"RSA-SHA\"+e);return o.update(r),o.verify(n,t,\"base64\")}}function m(e){var r=b(e);return function(){var t=r.apply(null,arguments);return t=a.derToJose(t,\"ES\"+e)}}function w(e){var r=v(e);return function(t,n,o){return n=a.joseToDer(n,\"ES\"+e).toString(\"base64\"),r(t,n,o)}}function x(){return function(){return\"\"}}function j(){return function(e,r){return\"\"===r}}e.exports=function(e){var r={hs:y,rs:b,es:m,none:x},t={hs:g,rs:v,es:w,none:j},n=e.match(/^(RS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw p('\"%s\" is not a valid algorithm.\\n  Supported algorithms are:\\n  \"HS256\", \"HS384\", \"HS512\", \"RS256\", \"RS384\", \"RS512\" and \"none\".',e);var o=(n[1]||n[3]).toLowerCase(),i=n[2];return{sign:r[o](i),verify:t[o](i)}}},function(e,r,t){var n=t(25).Buffer;e.exports=function(e){return\"string\"==typeof e?e:\"number\"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},function(e,r,t){var n=t(22),o=function(e,r){n.call(this,e),this.name=\"NotBeforeError\",this.date=r};(o.prototype=Object.create(n.prototype)).constructor=o,e.exports=o},function(e,r,t){var n=t(22),o=function(e,r){n.call(this,e),this.name=\"TokenExpiredError\",this.expiredAt=r};(o.prototype=Object.create(n.prototype)).constructor=o,e.exports=o},function(e,r,t){var n=t(48);e.exports=function(e,r){var t=r||Math.floor(Date.now()/1e3);if(\"string\"==typeof e){var o=n(e);if(void 0===o)return;return Math.floor(t+o/1e3)}return\"number\"==typeof e?t+e:void 0}},function(e,r,t){\"use strict\";var n=t(36),o=t(57);e.exports={Strategy:n,ExtractJwt:o}},function(e,r,t){var n=t(37),o=(t(26),t(20)),i=(t(27),t(38));function a(e,r){if(n.Strategy.call(this),this.name=\"jwt\",this._secretOrKeyProvider=e.secretOrKeyProvider,e.secretOrKey){if(this._secretOrKeyProvider)throw new TypeError(\"JwtStrategy has been given both a secretOrKey and a secretOrKeyProvider\");this._secretOrKeyProvider=function(r,t,n){n(null,e.secretOrKey)}}if(!this._secretOrKeyProvider)throw new TypeError(\"JwtStrategy requires a secret or key\");if(this._verify=r,!this._verify)throw new TypeError(\"JwtStrategy requires a verify callback\");if(this._jwtFromRequest=e.jwtFromRequest,!this._jwtFromRequest)throw new TypeError(\"JwtStrategy requires a function to retrieve jwt from requests (see option jwtFromRequest)\");this._passReqToCallback=e.passReqToCallback;var t=e.jsonWebTokenOptions||{};this._verifOpts=i({},t,{audience:e.audience,issuer:e.issuer,algorithms:e.algorithms,ignoreExpiration:!!e.ignoreExpiration})}o.inherits(a,n.Strategy),a.JwtVerifier=t(39),a.prototype.authenticate=function(e,r){var t=this,n=t._jwtFromRequest(e);if(!n)return t.fail(new Error(\"No auth token\"));this._secretOrKeyProvider(e,n,function(r,o){r?t.fail(r):a.JwtVerifier(n,o,t._verifOpts,function(r,n){if(r)return t.fail(r);var o=function(e,r,n){return e?t.error(e):r?t.success(r,n):t.fail(n)};try{t._passReqToCallback?t._verify(e,n,o):t._verify(n,o)}catch(e){t.error(e)}})})},e.exports=a},function(e,r){e.exports=require(\"passport-strategy\")},function(e,r){e.exports=function(e,r){if(null==e)throw new TypeError(\"Cannot convert undefined or null to object\");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t}},function(e,r,t){var n=t(40);e.exports=function(e,r,t,o){return n.verify(e,r,t,o)}},function(e,r,t){e.exports={decode:t(28),verify:t(47),sign:t(49),JsonWebTokenError:t(22),NotBeforeError:t(32),TokenExpiredError:t(33)}},function(e,r,t){var n=t(21).Buffer,o=t(29),i=t(30),a=t(24),u=t(31),s=t(20);function f(e,r){return n.from(e,r).toString(\"base64\").replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function c(e){var r=e.header,t=e.payload,n=e.secret||e.privateKey,o=e.encoding,a=i(r.alg),c=function(e,r,t){t=t||\"utf8\";var n=f(u(e),\"binary\"),o=f(u(r),t);return s.format(\"%s.%s\",n,o)}(r,t,o),l=a.sign(c,n);return s.format(\"%s.%s\",c,l)}function l(e){var r=e.secret||e.privateKey||e.key,t=new o(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new o(e.payload),this.secret.once(\"close\",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once(\"close\",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}s.inherits(l,a),l.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit(\"done\",e),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},l.sign=c,e.exports=l},function(e,r,t){\"use strict\";var n=t(25).Buffer,o=t(25).SlowBuffer;function i(e,r){if(!n.isBuffer(e)||!n.isBuffer(r))return!1;if(e.length!==r.length)return!1;for(var t=0,o=0;o<e.length;o++)t|=e[o]^r[o];return 0===t}e.exports=i,i.install=function(){n.prototype.equal=o.prototype.equal=function(e){return i(this,e)}};var a=n.prototype.equal,u=o.prototype.equal;i.restore=function(){n.prototype.equal=a,o.prototype.equal=u}},function(e,r){e.exports=require(\"crypto\")},function(e,r,t){\"use strict\";var n=t(21).Buffer,o=t(45),i=128,a=48,u=2;function s(e){if(n.isBuffer(e))return e;if(\"string\"==typeof e)return n.from(e,\"base64\");throw new TypeError(\"ECDSA signature must be a Base64 string or a Buffer\")}function f(e,r,t){for(var n=0;r+n<t&&0===e[r+n];)++n;return e[r+n]>=i&&--n,n}e.exports={derToJose:function(e,r){e=s(e);var t=o(r),f=t+1,c=e.length,l=0;if(e[l++]!==a)throw new Error('Could not find expected \"seq\"');var p=e[l++];if(p===(1|i)&&(p=e[l++]),c-l<p)throw new Error('\"seq\" specified length of \"'+p+'\", only \"'+(c-l)+'\" remaining');if(e[l++]!==u)throw new Error('Could not find expected \"int\" for \"r\"');var d=e[l++];if(c-l-2<d)throw new Error('\"r\" specified length of \"'+d+'\", only \"'+(c-l-2)+'\" available');if(f<d)throw new Error('\"r\" specified length of \"'+d+'\", max of \"'+f+'\" is acceptable');var h=l;if(l+=d,e[l++]!==u)throw new Error('Could not find expected \"int\" for \"s\"');var y=e[l++];if(c-l!==y)throw new Error('\"s\" specified length of \"'+y+'\", expected \"'+(c-l)+'\"');if(f<y)throw new Error('\"s\" specified length of \"'+y+'\", max of \"'+f+'\" is acceptable');var g=l;if((l+=y)!==c)throw new Error('Expected to consume entire buffer, but \"'+(c-l)+'\" bytes remain');var b=t-d,v=t-y,m=n.allocUnsafe(b+d+v+y);for(l=0;l<b;++l)m[l]=0;e.copy(m,l,h+Math.max(-b,0),h+d);for(var w=l=t;l<w+v;++l)m[l]=0;return e.copy(m,l,g+Math.max(-v,0),g+y),m=function(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}(m=m.toString(\"base64\"))},joseToDer:function(e,r){e=s(e);var t=o(r),c=e.length;if(c!==2*t)throw new TypeError('\"'+r+'\" signatures must be \"'+2*t+'\" bytes, saw \"'+c+'\"');var l=f(e,0,t),p=f(e,t,e.length),d=t-l,h=t-p,y=2+d+1+1+h,g=y<i,b=n.allocUnsafe((g?2:3)+y),v=0;return b[v++]=a,g?b[v++]=y:(b[v++]=1|i,b[v++]=255&y),b[v++]=u,b[v++]=d,l<0?(b[v++]=0,v+=e.copy(b,v,0,t)):v+=e.copy(b,v,l,t),b[v++]=u,b[v++]=h,p<0?(b[v++]=0,e.copy(b,v,t)):e.copy(b,v,t+p),b}}},function(e,r,t){\"use strict\";function n(e){return(e/8|0)+(e%8==0?0:1)}var o={ES256:n(256),ES384:n(384),ES512:n(521)};e.exports=function(e){var r=o[e];if(r)return r;throw new Error('Unknown algorithm \"'+e+'\"')}},function(e,r,t){var n=t(21).Buffer,o=t(29),i=t(30),a=t(24),u=t(31),s=/^[a-zA-Z0-9\\-_]+?\\.[a-zA-Z0-9\\-_]+?\\.([a-zA-Z0-9\\-_]+)?$/;function f(e){if(function(e){return\"[object Object]\"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function c(e){var r=e.split(\".\",1)[0];return f(n.from(r,\"base64\").toString(\"binary\"))}function l(e){return e.split(\".\")[2]}function p(e){return s.test(e)&&!!c(e)}function d(e,r,t){if(!r){var n=new Error(\"Missing algorithm parameter for jws.verify\");throw n.code=\"MISSING_ALGORITHM\",n}var o=l(e=u(e)),a=function(e){return e.split(\".\",2).join(\".\")}(e);return i(r).verify(a,o,t)}function h(e,r){if(r=r||{},!p(e=u(e)))return null;var t=c(e);if(!t)return null;var o=function(e,r){r=r||\"utf8\";var t=e.split(\".\")[1];return n.from(t,\"base64\").toString(r)}(e);return(\"JWT\"===t.typ||r.json)&&(o=JSON.parse(o,r.encoding)),{header:t,payload:o,signature:l(e)}}function y(e){var r=(e=e||{}).secret||e.publicKey||e.key,t=new o(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new o(e.signature),this.secret.once(\"close\",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once(\"close\",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}t(20).inherits(y,a),y.prototype.verify=function(){try{var e=d(this.signature.buffer,this.algorithm,this.key.buffer),r=h(this.signature.buffer,this.encoding);return this.emit(\"done\",e,r),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},y.decode=h,y.isValid=p,y.verify=d,e.exports=y},function(e,r,t){var n=t(22),o=t(32),i=t(33),a=t(28),u=t(34),s=t(23);e.exports=function(e,r,t,f){var c;if(\"function\"!=typeof t||f||(f=t,t={}),t||(t={}),t=Object.assign({},t),c=f||function(e,r){if(e)throw e;return r},t.clockTimestamp&&\"number\"!=typeof t.clockTimestamp)return c(new n(\"clockTimestamp must be a number\"));var l=t.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return c(new n(\"jwt must be provided\"));if(\"string\"!=typeof e)return c(new n(\"jwt must be a string\"));var p,d=e.split(\".\");if(3!==d.length)return c(new n(\"jwt malformed\"));try{p=a(e,{complete:!0})}catch(e){return c(e)}if(!p)return c(new n(\"invalid token\"));var h,y=p.header;if(\"function\"==typeof r){if(!f)return c(new n(\"verify must be called asynchronous if secret or public key is provided as a callback\"));h=r}else h=function(e,t){return t(null,r)};return h(y,function(r,a){if(r)return c(new n(\"error in secret or public key callback: \"+r.message));var f,h=\"\"!==d[2].trim();if(!h&&a)return c(new n(\"jwt signature is required\"));if(h&&!a)return c(new n(\"secret or public key must be provided\"));if(h||t.algorithms||(t.algorithms=[\"none\"]),t.algorithms||(t.algorithms=~a.toString().indexOf(\"BEGIN CERTIFICATE\")||~a.toString().indexOf(\"BEGIN PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"]:~a.toString().indexOf(\"BEGIN RSA PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\"]:[\"HS256\",\"HS384\",\"HS512\"]),!~t.algorithms.indexOf(p.header.alg))return c(new n(\"invalid algorithm\"));try{f=s.verify(e,p.header.alg,a)}catch(e){return c(e)}if(!f)return c(new n(\"invalid signature\"));var y=p.payload;if(void 0!==y.nbf&&!t.ignoreNotBefore){if(\"number\"!=typeof y.nbf)return c(new n(\"invalid nbf value\"));if(y.nbf>l+(t.clockTolerance||0))return c(new o(\"jwt not active\",new Date(1e3*y.nbf)))}if(void 0!==y.exp&&!t.ignoreExpiration){if(\"number\"!=typeof y.exp)return c(new n(\"invalid exp value\"));if(l>=y.exp+(t.clockTolerance||0))return c(new i(\"jwt expired\",new Date(1e3*y.exp)))}if(t.audience){var g=Array.isArray(t.audience)?t.audience:[t.audience];if(!(Array.isArray(y.aud)?y.aud:[y.aud]).some(function(e){return g.some(function(r){return r instanceof RegExp?r.test(e):r===e})}))return c(new n(\"jwt audience invalid. expected: \"+g.join(\" or \")))}if(t.issuer&&(\"string\"==typeof t.issuer&&y.iss!==t.issuer||Array.isArray(t.issuer)&&-1===t.issuer.indexOf(y.iss)))return c(new n(\"jwt issuer invalid. expected: \"+t.issuer));if(t.subject&&y.sub!==t.subject)return c(new n(\"jwt subject invalid. expected: \"+t.subject));if(t.jwtid&&y.jti!==t.jwtid)return c(new n(\"jwt jwtid invalid. expected: \"+t.jwtid));if(t.maxAge){if(\"number\"!=typeof y.iat)return c(new n(\"iat required when maxAge is specified\"));var b=u(t.maxAge,y.iat);if(void 0===b)return c(new n('\"maxAge\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));if(l>=b+(t.clockTolerance||0))return c(new i(\"maxAge exceeded\",new Date(1e3*b)))}return c(null,y)})}},function(e,r){e.exports=require(\"ms\")},function(e,r,t){var n=t(34),o=t(23),i=t(50),a=t(51),u=t(52),s=t(53),f=t(54),c=t(55),l=t(56),p={expiresIn:{isValid:function(e){return u(e)||c(e)},message:'\"expiresIn\" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return u(e)||c(e)},message:'\"notBefore\" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return c(e)||Array.isArray(e)},message:'\"audience\" must be a string or array'},algorithm:{isValid:i.bind(null,[\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\",\"HS256\",\"HS384\",\"HS512\",\"none\"]),message:'\"algorithm\" must be a valid string enum value'},header:{isValid:f,message:'\"header\" must be an object'},encoding:{isValid:c,message:'\"encoding\" must be a string'},issuer:{isValid:c,message:'\"issuer\" must be a string'},subject:{isValid:c,message:'\"subject\" must be a string'},jwtid:{isValid:c,message:'\"jwtid\" must be a string'},noTimestamp:{isValid:a,message:'\"noTimestamp\" must be a boolean'},keyid:{isValid:c,message:'\"keyid\" must be a string'},mutatePayload:{isValid:a,message:'\"mutatePayload\" must be a boolean'}},d={iat:{isValid:s,message:'\"iat\" should be a number of seconds'},exp:{isValid:s,message:'\"exp\" should be a number of seconds'},nbf:{isValid:s,message:'\"nbf\" should be a number of seconds'}};function h(e,r,t,n){if(!f(t))throw new Error('Expected \"'+n+'\" to be a plain object.');Object.keys(t).forEach(function(o){var i=e[o];if(i){if(!i.isValid(t[o]))throw new Error(i.message)}else if(!r)throw new Error('\"'+o+'\" is not allowed in \"'+n+'\"')})}var y={audience:\"aud\",issuer:\"iss\",subject:\"sub\",jwtid:\"jti\"},g=[\"expiresIn\",\"notBefore\",\"noTimestamp\",\"audience\",\"issuer\",\"subject\",\"jwtid\"];e.exports=function(e,r,t,i){\"function\"==typeof t?(i=t,t={}):t=t||{};var a=\"object\"==typeof e&&!Buffer.isBuffer(e),u=Object.assign({alg:t.algorithm||\"HS256\",typ:a?\"JWT\":void 0,kid:t.keyid},t.header);function s(e){if(i)return i(e);throw e}if(!r&&\"none\"!==t.algorithm)return s(new Error(\"secretOrPrivateKey must have a value\"));if(void 0===e)return s(new Error(\"payload is required\"));if(a){try{!function(e){h(d,!0,e,\"payload\")}(e)}catch(e){return s(e)}t.mutatePayload||(e=Object.assign({},e))}else{var f=g.filter(function(e){return void 0!==t[e]});if(f.length>0)return s(new Error(\"invalid \"+f.join(\",\")+\" option for \"+typeof e+\" payload\"))}if(void 0!==e.exp&&void 0!==t.expiresIn)return s(new Error('Bad \"options.expiresIn\" option the payload already has an \"exp\" property.'));if(void 0!==e.nbf&&void 0!==t.notBefore)return s(new Error('Bad \"options.notBefore\" option the payload already has an \"nbf\" property.'));try{!function(e){h(p,!1,e,\"options\")}(t)}catch(e){return s(e)}var c=e.iat||Math.floor(Date.now()/1e3);if(t.noTimestamp?delete e.iat:e.iat=c,void 0!==t.notBefore&&(e.nbf=n(t.notBefore,c),void 0===e.nbf))return s(new Error('\"notBefore\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));if(void 0!==t.expiresIn&&\"object\"==typeof e&&(e.exp=n(t.expiresIn,c),void 0===e.exp))return s(new Error('\"expiresIn\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));Object.keys(y).forEach(function(r){var n=y[r];if(void 0!==t[r]){if(void 0!==e[n])return s(new Error('Bad \"options.'+r+'\" option. The payload already has an \"'+n+'\" property.'));e[n]=t[r]}});var b=t.encoding||\"utf8\";if(\"function\"!=typeof i)return o.sign({header:u,payload:e,secret:r,encoding:b});i=i&&l(i),o.createSign({header:u,privateKey:r,payload:e,encoding:b}).once(\"error\",i).once(\"done\",function(e){i(null,e)})}},function(e,r){var t=1/0,n=9007199254740991,o=1.7976931348623157e308,i=NaN,a=\"[object Arguments]\",u=\"[object Function]\",s=\"[object GeneratorFunction]\",f=\"[object String]\",c=\"[object Symbol]\",l=/^\\s+|\\s+$/g,p=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,h=/^0o[0-7]+$/i,y=/^(?:0|[1-9]\\d*)$/,g=parseInt;function b(e){return e!=e}function v(e,r){return function(e,r){for(var t=-1,n=e?e.length:0,o=Array(n);++t<n;)o[t]=r(e[t],t,e);return o}(r,function(r){return e[r]})}var m=Object.prototype,w=m.hasOwnProperty,x=m.toString,j=m.propertyIsEnumerable,S=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),E=Math.max;function O(e,r){var t=T(e)||function(e){return function(e){return B(e)&&k(e)}(e)&&w.call(e,\"callee\")&&(!j.call(e,\"callee\")||x.call(e)==a)}(e)?function(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}(e.length,String):[],n=t.length,o=!!n;for(var i in e)!r&&!w.call(e,i)||o&&(\"length\"==i||_(i,n))||t.push(i);return t}function q(e){if(!function(e){var r=e&&e.constructor,t=\"function\"==typeof r&&r.prototype||m;return e===t}(e))return S(e);var r=[];for(var t in Object(e))w.call(e,t)&&\"constructor\"!=t&&r.push(t);return r}function _(e,r){return!!(r=null==r?n:r)&&(\"number\"==typeof e||y.test(e))&&e>-1&&e%1==0&&e<r}var T=Array.isArray;function k(e){return null!=e&&function(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var r=A(e)?x.call(e):\"\";return r==u||r==s}(e)}function A(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}function B(e){return!!e&&\"object\"==typeof e}e.exports=function(e,r,n,a){e=k(e)?e:function(e){return e?v(e,function(e){return k(e)?O(e):q(e)}(e)):[]}(e),n=n&&!a?function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||B(e)&&x.call(e)==c}(e))return i;if(A(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=A(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(l,\"\");var t=d.test(e);return t||h.test(e)?g(e.slice(2),t?2:8):p.test(e)?i:+e}(e))===t||e===-t){var r=e<0?-1:1;return r*o}return e==e?e:0}(e),n=r%1;return r==r?n?r-n:r:0}(n):0;var u=e.length;return n<0&&(n=E(u+n,0)),function(e){return\"string\"==typeof e||!T(e)&&B(e)&&x.call(e)==f}(e)?n<=u&&e.indexOf(r,n)>-1:!!u&&function(e,r,t){if(r!=r)return function(e,r,t,n){for(var o=e.length,i=t+(n?1:-1);n?i--:++i<o;)if(r(e[i],i,e))return i;return-1}(e,b,t);for(var n=t-1,o=e.length;++n<o;)if(e[n]===r)return n;return-1}(e,r,n)>-1}},function(e,r){var t=\"[object Boolean]\",n=Object.prototype.toString;e.exports=function(e){return!0===e||!1===e||function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=1/0,n=1.7976931348623157e308,o=NaN,i=\"[object Symbol]\",a=/^\\s+|\\s+$/g,u=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,f=/^0o[0-7]+$/i,c=parseInt,l=Object.prototype.toString;function p(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}e.exports=function(e){return\"number\"==typeof e&&e==function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&l.call(e)==i}(e))return o;if(p(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=p(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(a,\"\");var t=s.test(e);return t||f.test(e)?c(e.slice(2),t?2:8):u.test(e)?o:+e}(e))===t||e===-t){var r=e<0?-1:1;return r*n}return e==e?e:0}(e),d=r%1;return r==r?d?r-d:r:0}(e)}},function(e,r){var t=\"[object Number]\",n=Object.prototype.toString;e.exports=function(e){return\"number\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=\"[object Object]\";var n=Function.prototype,o=Object.prototype,i=n.toString,a=o.hasOwnProperty,u=i.call(Object),s=o.toString,f=function(e,r){return function(t){return e(r(t))}}(Object.getPrototypeOf,Object);e.exports=function(e){if(!function(e){return!!e&&\"object\"==typeof e}(e)||s.call(e)!=t||function(e){var r=!1;if(null!=e&&\"function\"!=typeof e.toString)try{r=!!(e+\"\")}catch(e){}return r}(e))return!1;var r=f(e);if(null===r)return!0;var n=a.call(r,\"constructor\")&&r.constructor;return\"function\"==typeof n&&n instanceof n&&i.call(n)==u}},function(e,r){var t=\"[object String]\",n=Object.prototype.toString,o=Array.isArray;e.exports=function(e){return\"string\"==typeof e||!o(e)&&function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=\"Expected a function\",n=1/0,o=1.7976931348623157e308,i=NaN,a=\"[object Symbol]\",u=/^\\s+|\\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,p=Object.prototype.toString;function d(e,r){var d;if(\"function\"!=typeof r)throw new TypeError(t);return e=function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&p.call(e)==a}(e))return i;if(h(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=h(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(u,\"\");var t=f.test(e);return t||c.test(e)?l(e.slice(2),t?2:8):s.test(e)?i:+e}(e))===n||e===-n){var r=e<0?-1:1;return r*o}return e==e?e:0}(e),t=r%1;return r==r?t?r-t:r:0}(e),function(){return--e>0&&(d=r.apply(this,arguments)),e<=1&&(r=void 0),d}}function h(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}e.exports=function(e){return d(2,e)}},function(e,r,t){\"use strict\";var n=t(27),o=t(26),i={fromHeader:function(e){return function(r){var t=null;return r.headers[e]&&(t=r.headers[e]),t}},fromBodyField:function(e){return function(r){var t=null;return r.body&&Object.prototype.hasOwnProperty.call(r.body,e)&&(t=r.body[e]),t}},fromUrlQueryParameter:function(e){return function(r){var t=null,o=n.parse(r.url,!0);return o.query&&Object.prototype.hasOwnProperty.call(o.query,e)&&(t=o.query[e]),t}},fromAuthHeaderWithScheme:function(e){var r=e.toLowerCase();return function(e){var t=null;if(e.headers.authorization){var n=o.parse(e.headers.authorization);n&&r===n.scheme.toLowerCase()&&(t=n.value)}return t}},fromAuthHeaderAsBearerToken:function(){return i.fromAuthHeaderWithScheme(\"bearer\")},fromExtractors:function(e){if(!Array.isArray(e))throw new TypeError(\"extractors.fromExtractors expects an array\");return function(r){for(var t=null,n=0;!t&&n<e.length;)t=e[n].call(this,r),n++;return t}},versionOneCompatibility:function(e){var r=e.authScheme||\"JWT\",t=e.tokenBodyField||\"auth_token\",n=e.tokenQueryParameterName||\"auth_token\";return function(e){var o=i.fromAuthHeaderWithScheme(r)(e);o||(o=i.fromBodyField(t)(e));o||(o=i.fromUrlQueryParameter(n)(e));return o}}};e.exports=i}]);","extractedComments":[]}