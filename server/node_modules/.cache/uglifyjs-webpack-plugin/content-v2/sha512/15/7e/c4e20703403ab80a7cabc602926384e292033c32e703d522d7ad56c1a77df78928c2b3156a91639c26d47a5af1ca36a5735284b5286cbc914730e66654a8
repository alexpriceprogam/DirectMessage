{"code":"module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=8)}([function(e,t){e.exports=require(\"express\")},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.authJwt=t.authLocal=void 0;var r=u(n(2)),o=u(n(3)),s=n(9),i=u(n(4));function u(e){return e&&e.__esModule?e:{default:e}}const a=new o.default({usernameField:\"email\"},async(e,t,n)=>{console.log(\"local strategy\");try{const r=await i.default.findOne({email:e});return r?r.authenticateUser(t)?n(null,r):n(\"Wrong password.\",!1):n(\"User does not exist!\",!1)}catch(e){return n(e,!1)}}),l={jwtFromRequest:s.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:\"SecretKey\"},d=new s.Strategy(l,async(e,t)=>{try{const n=await i.default.findById(e._id);return t(null,n?n:!1)}catch(e){return t(e,!1)}});r.default.use(a),r.default.use(d);t.authLocal=r.default.authenticate(\"local\",{session:!1},function(e,t){console.log(\"authLocal\"),console.log(t),e.send(t),console.log(user),console.log(info),console.log(\"end\")}),t.authJwt=r.default.authenticate(\"jwt\",{session:!1})},function(e,t){e.exports=require(\"passport\")},function(e,t){e.exports=require(\"passport-local\")},function(e,t,n){\"use strict\";var r=a(n(5)),o=a(n(10)),s=a(n(11)),i=n(6),u=a(n(12));function a(e){return e&&e.__esModule?e:{default:e}}let l=new r.default.Schema({email:{type:String,unique:!0,required:[!0,\"Email address required!\"],validate:{validator:e=>o.default.isEmail(e)},message:\"{VALUE} is not a valid email.\"},name:{type:String,required:!0,max:100},password:{type:String},conversations:{type:[String]},friends:{type:[String]}});l.plugin(s.default,{message:\"{VALUE} already taken!\"}),l.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),l.methods={_hashPassword:e=>(0,i.hashSync)(e),authenticateUser(e){return(0,i.compareSync)(e,this.password)},createToken(){return u.default.sign({_id:this._id},\"SecretKey\")},toJSON(){return{_id:this._id,name:this.name,token:`JWT ${this.createToken()}`,email:this.email,friends:this.friends,conversations:this.conversations}}},e.exports=r.default.model(\"User\",l)},function(e,t){e.exports=require(\"mongoose\")},function(e,t){e.exports=require(\"bcrypt-nodejs\")},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.registerUser=async function(e,t){try{const n=await r.create(e.body);return console.log(n),t.status(201).json(n)}catch(e){return t.status(500).json(e)}},t.loginUser=function(e,t,n){console.log(\"login user\");try{return console.log(e),console.log(e.user),t.status(200).json(e.user.toJSON()),n()}catch(e){return console.log(e),t.status(500).json(e)}},t.addFriend=function(e,t){console.log(e.body),console.log(e.body.loggedInUser._id);let n=o(e.body.loggedInUser._id),s=o(e.body.newFriend._id);r.findOneAndUpdate({_id:n},{$addToSet:{friends:s}},{new:!0},function(e,n){if(e)return handleError(e);t.send(n)})};const r=n(4);n(0);let o=n(23).ObjectId;t.getUser=function(e,t){console.log(\"indexing users\");let n=\"\";r.find({name:\"Jimmy Testing\"},function(e,r){if(0!=r.length){for(let e=0;e<r.length;e++)n+=r[e].name;t.send(n)}else t.send(\"Sorry no user\")})},t.showUser=function(e,t){let n=new RegExp(e.params.query,\"i\");console.log(n),r.find({$or:[{email:n},{name:n}]},function(e,n){t.send(n)})},t.createUser=function(e,t){new r({name:e.body.name}).save(function(n){if(n)return console.log(n),next(n);t.send(\"Created user, \"+e.body.name)})},t.newUser=function(e,t){t.render(\"newUser\",{})},t.newRegisterUser=function(e,t){t.render(\"register\",{})},t.newLoginUser=function(e,t){t.render(\"register\",{})}},function(e,t,n){\"use strict\";var r=n(1);const o=n(0),s=(n(13),n(14)),i=(n(15)(s),n(16)),u=n(2),a=(n(3).Strategy,n(17),n(6),n(5)),l=n(18),d=n(19);a.connect(\"mongodb://localhost/ChatAppDB\");const c=o();c.use(l()),c.use(i.urlencoded({extended:!0})),c.use(i.json()),c.use(u.initialize()),c.set(\"view engine\",\"ejs\"),c.use(\"/user\",d),c.get(\"/\",(e,t)=>{t.send(\"You got home page!\\n\")}),c.get(\"/login\",(e,t)=>{t.render(\"login\",{})}),c.post(\"/login\",(e,t,n)=>{console.log(\"app.post('/login')\"),u.authenticate(\"local\",(r,o,s)=>s?t.send(s.message):r?n(r):o?void e.login(o,e=>e?n(e):t.redirect(\"/authrequired\")):t.redirect(\"/login\"))(e,t,n)}),c.get(\"/authrequired\",(e,t)=>{e.isAuthenticated()?t.send(\"you hit the authentication endpoint\\n\"):t.redirect(\"/\")}),c.get(\"/private\",r.authJwt,(e,t)=>{t.send(\"Private info!\")}),c.listen(3e3,()=>{console.log(\"Listening on localhost:3000\")}),e.exports=c},function(e,t){e.exports=require(\"passport-jwt\")},function(e,t){e.exports=require(\"validator\")},function(e,t){e.exports=require(\"mongoose-unique-validator\")},function(e,t){e.exports=require(\"jsonwebtoken\")},function(e,t){e.exports=require(\"uuid/v4\")},function(e,t){e.exports=require(\"express-session\")},function(e,t){e.exports=require(\"session-file-store\")},function(e,t){e.exports=require(\"body-parser\")},function(e,t){e.exports=require(\"axios\")},function(e,t){e.exports=require(\"cors\")},function(e,t,n){\"use strict\";var r=u(n(20)),o=u(n(21)),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};r.get||r.set?Object.defineProperty(t,n,r):t[n]=e[n]}return t.default=e,t}(n(7)),i=n(1);function u(e){return e&&e.__esModule?e:{default:e}}const a=n(0).Router(),l=n(7);a.get(\"/show\",l.getUser),a.post(\"/new\",l.createUser),a.get(\"/new\",l.newUser),a.post(\"/register\",(0,r.default)(o.default.loginUser),s.registerUser),a.get(\"/register\",l.newRegisterUser),a.post(\"/login\",i.authLocal,s.loginUser),a.get(\"/show/:query\",l.showUser),a.post(\"/add_friend\",s.addFriend),e.exports=a},function(e,t){e.exports=require(\"express-validation\")},function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(22));t.default={loginUser:{body:{email:r.default.string().email().required(),password:r.default.string().required(),name:r.default.string().required()}}}},function(e,t){e.exports=require(\"joi\")},function(e,t){e.exports=require(\"mongodb\")}]);","extractedComments":[]}